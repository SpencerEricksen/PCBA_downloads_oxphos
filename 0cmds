
# get list of ASSAY AIDs to download

grep pcba-aid* get_bioassay_oxphos_all_assays.log > x
grep pcba-aid* get_bioassay_oxphos_all_assays_contd.log > y
cat x y > z
cat z | cut -f2 -d"-" | cut -f1 -d"." | cut -c4- > zz
 

#############################

# download AID data tables for each AID (output files go to 'AIDs' folder
nohup ./get_bioassay_data_v1.3.py assay_list.list > get_bioassay_oxphos_all_assays.log 2>&1 &

# prepare CID CSVs (including columns PUBCHEM_ACTIVITY_OUTCOMES and PUBCHEM_ACTIVITY_SCORE)
for aid in AIDs/pcba-aid*.csv; do ./dump_assay_cid_activity_csv.py ${aid}; done

# prepare .xml files from CID lists for each AID, these will be used to fetch smiles for CIDs using PUG REST
for c in CID_lists/pcba-aid*_activities.csv; do ./0A_write_cgi_v1.3.py $c; echo $c; done

# fetch the smiles for each AID
for f in pc_fetch_aid1[1234]*; do ./wrapper_fetch_v1.2.sh $f; done

# merge smiles and assay outcomes into individal files for each AID
# add substructure 'match' result, ...
for a in `cat assay_list.list`; do echo ${a}; ./rdkit_substructure_matcher_v1.6.py ${a}; done

# merge all of these assay data tables:
cat aid_*.csv > all_oxphos_aids_cids.csv
sed -i '2,${/PUBCHEM_CID/d;}' all_oxphos_aids_cids.csv

# process all_oxphos_aids.csv to add fingerprints (RDKit Morgan fingerprints of radius=3 and 2048 bits)
./rdkit_add_fingerprints.py




##  extras  ##############################

# had to finish merging dataframes when terminal connection was disrupted, need list of unfinshed assays
with open('z', 'r') as fh:
    data = fh.readlines()
newdata = [ i.strip() for i in data ]
with open('zz', 'w') as dump:
    for i in newdata:
        print >> dump, i

# remove any garbage lines from previous get_bioassay_data versions
for f in pcba-aid*.csv; do sed -i -e '/^Code:/d' -e '/^Message:/d' -e '/^Status:/d' $f; echo $f; done





